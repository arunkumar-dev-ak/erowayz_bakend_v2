model VendorSubscription {
  id                 String   @id @default(uuid())
  vendorId           String
  paymentId          String?   @unique

  // Snapshot of the plan details at the time of subscription
  planId             String?
  planName           String
  planFeatures       Json
  planBillingPeriod  BillingPeriod
  planPrice          Int
  planDiscountPrice  Int?
  referredVendorId   String?

  startDate          DateTime
  endDate            DateTime
  isActive           Boolean   @default(true)

  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt

  // Relations
  vendor             Vendor   @relation(name: "VendorSubscriptionVendor", fields: [vendorId], references: [id])
  referredVendor     Vendor?  @relation(name: "VendorSubscriptionReferredVendor", fields: [referredVendorId], references: [id])

  payment            Payment?  @relation(fields: [paymentId], references: [id])
  plan               SubscriptionPlan? @relation(fields: [planId], references: [id], onDelete: SetNull)

  vendorFeatureUsage  VendorFeatureUsage[]
}

model VendorFeatureUsage {
  id         String   @id @default(uuid())
  itemId     String?
  shopId     String?
  feature    String
  usageCount Int      @default(0)
  vendorSubscriptionId  String

  vendorSubscription     VendorSubscription   @relation(fields: [vendorSubscriptionId], references: [id])
  shopInfo   ShopInfo?  @relation(fields: [shopId], references: [id])
  item       Item?  @relation(fields: [itemId], references: [id])

  @@unique([feature,vendorSubscriptionId,itemId])
  @@index([itemId])
  @@index([shopId])
}